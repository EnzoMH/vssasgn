<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Warehouse Management System</title>
    <link rel="stylesheet" href="/static/css/style.css" />
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- 헤더 -->
    <header class="header">
      <div class="header-content">
        <h1>
          <i class="fas fa-warehouse"></i> Smart Warehouse Management System
        </h1>
        <div class="header-actions">
          <button id="refreshBtn" class="btn btn-primary">
            <i class="fas fa-sync-alt"></i> 새로고침
          </button>
          <button id="uploadBtn" class="btn btn-secondary">
            <i class="fas fa-upload"></i> 데이터 업로드
          </button>
        </div>
      </div>
    </header>

    <!-- 메인 대시보드 -->
    <main class="main-content">
      <!-- KPI 카드 섹션 -->
      <section class="kpi-section">
        <div class="kpi-card" id="totalInventoryCard">
          <div class="kpi-icon">
            <i class="fas fa-boxes"></i>
          </div>
          <div class="kpi-content">
            <h3>총 재고량</h3>
            <div class="kpi-value" id="totalInventory">--</div>
            <div class="kpi-unit">개</div>
          </div>
        </div>

        <div class="kpi-card" id="dailyThroughputCard">
          <div class="kpi-icon">
            <i class="fas fa-truck"></i>
          </div>
          <div class="kpi-content">
            <h3>일일 처리량</h3>
            <div class="kpi-value" id="dailyThroughput">--</div>
            <div class="kpi-unit">건</div>
          </div>
        </div>

        <div class="kpi-card" id="rackUtilizationCard">
          <div class="kpi-icon">
            <i class="fas fa-chart-pie"></i>
          </div>
          <div class="kpi-content">
            <h3>랙 활용률</h3>
            <div class="kpi-value" id="rackUtilization">--%</div>
            <div class="kpi-unit">%</div>
          </div>
        </div>

        <div class="kpi-card" id="inventoryTurnoverCard">
          <div class="kpi-icon">
            <i class="fas fa-redo"></i>
          </div>
          <div class="kpi-content">
            <h3>재고 회전율</h3>
            <div class="kpi-value" id="inventoryTurnover">--</div>
            <div class="kpi-unit">회</div>
          </div>
        </div>
      </section>

      <!-- 차트 섹션 -->
      <section class="charts-section">
        <!-- 랙별 재고 현황 -->
        <div class="chart-container">
          <div class="chart-header">
            <h3><i class="fas fa-chart-bar"></i> 랙별 재고 현황</h3>
          </div>
          <canvas id="inventoryChart"></canvas>
        </div>

        <!-- 일별 입출고 트렌드 -->
        <div class="chart-container">
          <div class="chart-header">
            <h3><i class="fas fa-chart-line"></i> 일별 입출고 트렌드</h3>
          </div>
          <canvas id="trendChart"></canvas>
        </div>

        <!-- 제품 카테고리 분포 -->
        <div class="chart-container">
          <div class="chart-header">
            <h3><i class="fas fa-chart-pie"></i> 제품 카테고리 분포</h3>
          </div>
          <canvas id="categoryChart"></canvas>
        </div>

        <!-- ML 모델 결과 -->
        <div class="chart-container">
          <div class="chart-header">
            <h3><i class="fas fa-brain"></i> AI 분석 결과</h3>
            <div class="ml-controls">
              <button id="demandPredictBtn" class="btn btn-sm btn-primary">
                수요 예측
              </button>
              <button id="clusterAnalysisBtn" class="btn btn-sm btn-secondary">
                제품 클러스터링
              </button>
              <button id="anomalyDetectionBtn" class="btn btn-sm btn-warning">
                이상 탐지
              </button>
            </div>
          </div>
          <div id="mlResults" class="ml-results">
            <p>AI 분석 버튼을 클릭하여 결과를 확인하세요.</p>
          </div>
        </div>

        <!-- AI 차트 생성 -->
        <div class="chart-container ai-chart-container">
          <div class="chart-header">
            <h3><i class="fas fa-magic"></i> AI 차트 생성</h3>
            <div class="ai-chart-controls">
              <div class="input-group">
                <input
                  type="text"
                  id="chartRequestInput"
                  class="form-control"
                  placeholder="원하는 차트를 자연어로 요청하세요. 예: '최근 일주일 입고량을 막대차트로', '랙별 재고를 파이차트로'"
                />
                <button id="generateChartBtn" class="btn btn-primary">
                  <i class="fas fa-chart-bar"></i> 차트 생성
                </button>
              </div>
              <div class="quick-chart-buttons mt-2">
                <button
                  class="btn btn-sm btn-outline-primary quick-chart-btn"
                  data-request="최근 7일간 입고량을 막대차트로 보여줘"
                >
                  입고 트렌드
                </button>
                <button
                  class="btn btn-sm btn-outline-secondary quick-chart-btn"
                  data-request="랙별 재고 현황을 막대차트로 보여줘"
                >
                  랙별 재고
                </button>
                <button
                  class="btn btn-sm btn-outline-success quick-chart-btn"
                  data-request="공급업체별 입고량을 파이차트로 보여줘"
                >
                  공급업체 분석
                </button>
                <button
                  class="btn btn-sm btn-outline-warning quick-chart-btn"
                  data-request="상품별 출고량을 막대차트로 보여줘"
                >
                  상품별 출고
                </button>
              </div>
            </div>
          </div>
          <div class="ai-chart-content">
            <canvas id="aiGeneratedChart" style="min-height: 400px"></canvas>
          </div>
        </div>

        <!-- DWG CAD 시각화 섹션 -->
        <div class="chart-container cad-container">
          <div class="chart-header">
            <h3><i class="fas fa-drafting-compass"></i> DWG CAD 시각화</h3>
            <div class="cad-controls">
              <button id="uploadCADBtn" class="btn btn-primary">
                <i class="fas fa-upload"></i> DWG 업로드
              </button>
              <button id="toggleLayersBtn" class="btn btn-secondary" disabled>
                <i class="fas fa-layer-group"></i> 레이어
              </button>
              <button id="zoomFitBtn" class="btn btn-secondary" disabled>
                <i class="fas fa-expand"></i> 전체보기
              </button>
            </div>
          </div>

          <!-- CAD 파일 업로드 영역 -->
          <div id="cadUploadArea" class="cad-upload-area">
            <div class="upload-dropzone" id="cadDropzone">
              <div class="upload-icon">
                <i class="fas fa-file-code"></i>
              </div>
              <h4>DWG/DXF 파일 업로드</h4>
              <p>창고 도면 파일을 드래그하거나 클릭하여 업로드하세요</p>
              <p class="upload-hint">지원 형식: .dwg, .dxf, .dwf (최대 50MB)</p>
              <input
                type="file"
                id="cadFileInput"
                accept=".dwg,.dxf,.dwf"
                style="display: none"
              />
              <button id="selectCADFileBtn" class="btn btn-primary">
                <i class="fas fa-folder-open"></i> 파일 선택
              </button>
            </div>
          </div>

          <!-- CAD 뷰어 영역 -->
          <div id="cadViewer" class="cad-viewer" style="display: none">
            <div class="cad-canvas-container">
              <canvas id="warehouseCanvas" width="1000" height="600"></canvas>
              <div class="cad-loading" id="cadLoading" style="display: none">
                <div class="loading-spinner">
                  <i class="fas fa-spinner fa-spin"></i>
                  <p>도면을 분석하고 있습니다...</p>
                </div>
              </div>
            </div>

            <!-- CAD 정보 패널 -->
            <div class="cad-info-panel" id="cadInfoPanel">
              <h5><i class="fas fa-info-circle"></i> 선택된 영역 정보</h5>
              <div id="selectedRackInfo">
                <p>랙을 클릭하면 상세 정보가 표시됩니다.</p>
              </div>
            </div>
          </div>

          <!-- CAD 업로드 진행률 -->
          <div
            id="cadUploadProgress"
            class="upload-progress"
            style="display: none"
          >
            <div class="progress-bar">
              <div class="progress-fill" id="cadProgressFill"></div>
            </div>
            <div class="progress-text" id="cadProgressText">
              파일 업로드 중...
            </div>
          </div>

          <!-- CAD 분석 결과 -->
          <div
            id="cadAnalysisResult"
            class="upload-result"
            style="display: none"
          ></div>
        </div>
      </section>
    </main>

    <!-- AI 챗봇 (우측 하단 고정) -->
    <div id="aiChatWidget" class="ai-chat-widget">
      <div class="chat-toggle" id="chatToggle">
        <i class="fas fa-robot"></i>
        <span>AI 어시스턴트</span>
      </div>
      <div class="chat-container" id="chatContainer" style="display: none">
        <div class="chat-header">
          <h4><i class="fas fa-robot"></i> 창고 AI 어시스턴트</h4>
          <button id="closeChatBtn" class="close-btn">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="chat-messages" id="chatMessages">
          <div class="message bot-message">
            <div class="message-content">
              안녕하세요! 창고 관리에 대해 무엇이든 물어보세요.
              <br />예: "A랙의 재고량은?", "오늘 입고 현황은?", "재고 부족
              제품은?"
            </div>
            <div class="message-time"></div>
          </div>
        </div>
        <div class="chat-input-container">
          <input
            type="text"
            id="chatInput"
            placeholder="질문을 입력하세요..."
            class="chat-input"
          />
          <button id="sendChatBtn" class="send-btn">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- 파일 업로드 모달 -->
    <div id="uploadModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-upload"></i> 데이터 파일 업로드</h3>
          <button id="closeUploadModal" class="close-btn">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="upload-area" id="uploadArea">
            <div class="upload-icon">
              <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <p>CSV 또는 Excel 파일을 드래그하거나 클릭하여 업로드하세요</p>
            <input
              type="file"
              id="fileInput"
              accept=".csv,.xlsx,.xls"
              style="display: none"
            />
            <button id="selectFileBtn" class="btn btn-primary">
              파일 선택
            </button>
          </div>
          <div
            id="uploadProgress"
            class="upload-progress"
            style="display: none"
          >
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">업로드 중...</div>
          </div>
          <div
            id="uploadResult"
            class="upload-result"
            style="display: none"
          ></div>
        </div>
      </div>
    </div>

    <!-- 로딩 오버레이 -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <p>데이터를 불러오는 중...</p>
      </div>
    </div>

    <!-- JavaScript 파일들 -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/charts.js"></script>
    <script src="/static/js/aiChat.js"></script>
    <script src="/static/js/fileUpload.js"></script>
    <script src="/static/js/cadViewer.js"></script>
    <script src="/static/js/dashboard.js"></script>
  </body>
</html>
