## ML 모델 고도화 및 AI 챗봇 기능 확장 계획

### 1. ML 모델 고도화: 데이터를 통한 학습 상세 설명

'데이터를 통한 학습'이란 단순히 모델을 코드 상에 정의하는 것을 넘어, **실제 물류 창고 데이터를 활용하여 모델이 패턴을 학습하고, 실제 비즈니스 문제 해결에 기여할 수 있도록 만드는 과정**을 의미합니다. 이는 다음과 같은 단계들을 포함합니다:

- **1.1. 특징 공학 (Feature Engineering):**

  - **목표:** 원본 데이터(`inbound_data`, `outbound_data`, `product_master`)에서 ML 모델이 학습하고 예측하는 데 유용한 특징(variables)을 추출하고 생성합니다.
  - **수요 예측 (XGBoost):**
    - **시계열 특징:** 과거 `Date`별 입출고량(일별, 주별 평균/합계), 요일, 월, 공휴일 여부, 계절성 지수 등.
    - **제품 특징:** `상품코드` 또는 `ProductName`별 평균 입출고량, 변동성, 재고 회전율, 카테고리(원-핫 인코딩 등).
    - **외부 특징 (선택 사항):** 날씨, 프로모션 정보, 경쟁사 활동 (외부 데이터를 연동할 경우).
  - **제품 클러스터링 (K-Means):**
    - **회전율:** `상품코드`별 총 입고량/총 출고량 또는 재고 회전율.
    - **재고 특성:** 평균 `현재고`, 재고 변동폭.
    - **물리적 특성:** 제품 `Unit` (단위), 크기, 무게 (데이터가 있다면).
    - **수요 패턴:** 특정 시간/요일/계절에 집중되는지 여부.
  - **이상 탐지 (Isolation Forest):**
    - **시계열 변동:** 일별 `inbound`, `outbound` 외에 특정 상품군의 일별 입출고량, 특정 랙의 재고 변동량, `PalleteQty`의 평균/분포 변화 등.
    - **비율:** 입고량 대비 출고량 비율, 재고 대비 출고량 비율 등.

- **1.2. 데이터 전처리 및 정제 (Data Preprocessing & Cleaning):**

  - **목표:** 특징 공학을 통해 생성된 데이터를 모델이 이해하고 학습하기 적합한 형태로 가공합니다.
  - **누락값 처리:** 결측치(NaN)가 있는 특징 컬럼에 대해 평균, 중앙값, 최빈값 등으로 대체하거나 해당 행을 제거합니다. (현재 `DataService`에서 `Date` 결측치와 `Unnamed` 컬럼은 처리 중)
  - **이상치 처리:** AI가 지적한 '현재고' 고정 값과 같이 비정상적인 값들을 식별하고, 제거하거나 합리적인 값으로 대체합니다.
  - **스케일링:** 각 특징 컬럼의 값 범위가 다르다면(예: 입고량은 수백, 재고 회전율은 1 미만), Min-Max Scaling 또는 Standard Scaling을 적용하여 모델 학습 효율을 높입니다.
  - **범주형 변수 인코딩:** '랙위치', 'Supplier', 'Business name' 등 범주형 데이터를 원-핫 인코딩(One-Hot Encoding) 또는 레이블 인코딩(Label Encoding)과 같은 수치형 형태로 변환합니다.

- **1.3. 모델 학습 (Model Training):**

  - **목표:** 전처리된 데이터를 사용하여 각 ML 모델의 `train` 메서드를 호출하여 모델이 패턴을 학습하도록 합니다.
  - **수요 예측:** `X_train` (특징), `y_train` (예측할 목표 변수, 예: 다음날 출고량)을 분리하여 `demand_predictor.train(X_train, y_train)`을 실행합니다.
  - **제품 클러스터링:** `features_df` (클러스터링에 사용할 특징)를 준비하여 `product_clusterer.train(features_df)`를 실행합니다.
  - **이상 탐지:** `features_for_anomaly` (이상 탐지할 특징)를 준비하여 `anomaly_detector.train(features_for_anomaly)`를 실행합니다.

- **1.4. 모델 평가 및 튜닝 (Model Evaluation & Tuning):**

  - **목표:** 학습된 모델의 성능을 정량적으로 평가하고, 더 나은 성능을 위해 모델의 하이퍼파라미터를 조정합니다.
  - **수요 예측:** MAE (Mean Absolute Error), RMSE (Root Mean Squared Error), R-squared (결정계수) 등의 지표를 사용합니다.
  - **제품 클러스터링:** 실루엣 계수 (Silhouette Score), 캘린스키-하라바스 지수 (Calinski-Harabasz Index) 등을 사용하여 클러스터링 품질을 평가합니다.
  - **이상 탐지:** 정밀도 (Precision), 재현율 (Recall), F1-Score (이상치 데이터가 불균형할 경우 특히 중요) 등을 사용합니다.
  - **하이퍼파라미터 튜닝:** GridSearchCV, RandomizedSearchCV 등을 사용하여 모델의 최적 하이퍼파라미터를 찾습니다.

- **1.5. 모델 지속성 (Model Persistence):**
  - **목표:** 학습된 모델을 저장하고 필요할 때 다시 불러와서 예측에 활용합니다.
  - `joblib` 또는 `pickle` 라이브러리를 사용하여 학습된 모델 객체를 파일로 저장하고, 애플리케이션 시작 시 다시 로드합니다.

이러한 과정은 단순히 모델 코드를 작성하는 것을 넘어, 데이터를 분석하고, 모델에 맞는 형태로 가공하며, 성능을 최적화하는 반복적인 사이클을 의미합니다.

### 2. AI 챗봇 기능 확장 구체화

AI 챗봇 기능 확장은 현재 `analyze_data.py`를 통해 얻는 인사이트를 **프론트엔드 환경에서 사용자가 직접 질의하고, 그에 대한 응답을 ML 모델과 연동하여 실시간으로 얻는 것**을 목표로 합니다. 나아가 더 복잡한 추론과 능동적인 제안까지 가능하게 합니다.

- **2.1. 직접적인 ML 모델 연동을 통한 질의응답:**

  - **현재:** AI 챗봇은 `analyze_data.py`가 미리 생성한 분석 결과를 바탕으로 답변을 제공합니다.
  - **확장:** 사용자의 질문을 `WarehouseChatbot` (및 내부 `WarehouseAI`)이 분석하여, 질문의 의도에 따라 필요한 ML 모델(수요 예측, 클러스터링, 이상 탐지)을 직접 호출하고 그 결과를 답변에 포함시킵니다.
  - **예시:**
    - **사용자:** "내일 A 상품의 예상 출고량은 얼마인가요?"
    - **챗봇 로직:** 질문을 파싱하여 `DemandPredictor` 호출 -> 예측 결과 반환.
    - **사용자:** "현재 재고가 낮은 제품들의 클러스터 정보와 함께 재고 보충이 필요한 상품들을 알려주세요."
    - **챗봇 로직:** `ProductClusterer`와 `DataService`를 호출하여 필요한 정보 취합 -> 종합적인 답변 생성.
    - **사용자:** "이번 주 비정상적인 입고가 있었던 날짜는 언제인가요?"
    - **챗봇 로직:** `AnomalyDetector` 호출 -> 이상 징후 날짜 반환.

- **2.2. 실행 가능한(Actionable) 추천 및 최적화 제안:**

  - **현재:** AI는 데이터 분석 결과를 바탕으로 일반적인 개선점을 제시합니다.
  - **확장:** ML 모델의 예측 및 탐지 결과를 기반으로, 구체적이고 즉각적인 실행 방안을 제안합니다.
  - **예시:**
    - **이상 탐지 결과 기반:** "2025-01-01에 비정상적인 입고량 감소가 감지되었습니다. 이는 공급처 문제일 수 있으니, 해당 날짜의 공급망 데이터를 확인하고 담당자에게 연락하여 원인을 파악하세요."
    - **수요 예측 결과 기반:** "다음 주 A 상품의 수요가 크게 증가할 것으로 예측됩니다. 재고 부족을 방지하기 위해 오늘 중으로 A 상품 XX개를 추가 발주하는 것을 고려하십시오."
    - **랙 활용률 결과 기반:** "현재 U-Z 랙의 활용률이 15.4%로 매우 낮습니다. 재고 회전율이 낮은 상품들을 해당 랙으로 재배치하여 공간 활용 효율을 높일 수 있습니다."

- **2.3. LangChain/AI Agent Chain 개념 도입 (아키텍처 설계와 연계):**

  - 사용자의 복잡한 질문을 처리하기 위해, AI 챗봇 내부적으로 여러 '에이전트'가 협력하는 구조를 설계합니다.
  - **질의 이해 에이전트:** 사용자의 질문을 분석하여 어떤 정보가 필요한지, 어떤 ML 모델이나 데이터 서비스가 필요한지 판단합니다.
  - **데이터 검색/분석 에이전트:** `DataService`와 `DataAnalysisService`를 활용하여 필요한 데이터를 검색하고 분석합니다.
  - **ML 예측/탐지 에이전트:** `DemandPredictor`, `ProductClusterer`, `AnomalyDetector` 등 ML 모델을 호출하여 예측 및 탐지 결과를 생성합니다.
  - **응답 생성 에이전트:** 앞선 에이전트들로부터 받은 정보를 종합하고, 사용자에게 이해하기 쉽고 실행 가능한 형태의 답변을 생성합니다.
  - 이를 통해 CoT 추론을 더욱 자동화하고, AI의 문제 해결 능력을 향상시킬 수 있습니다.

- **2.4. 사용자 역할 기반 맞춤형 인사이트 (선택 사항):**
  - 향후 사용자 로그인 및 역할 시스템이 도입된다면, '창고 관리자', '재고 담당자', '운영 총괄' 등 사용자의 역할에 따라 맞춤형 인사이트와 알림을 제공할 수 있습니다.

이러한 확장은 챗봇이 단순한 정보 제공자를 넘어, 스마트 물류 창고 운영의 '두뇌' 역할을 수행하도록 만드는 방향입니다.
